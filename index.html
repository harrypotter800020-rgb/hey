<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>MediConnect ‚Äì Home ‚Ä¢ Emergency ‚Ä¢ 20 Blogs</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Leaflet (FREE, no API key) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* ----- MODERN VARIABLES ----- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #0f172a;
            --accent: #06b6d4;
            --soft-bg: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-sm: 0 10px 25px -5px rgba(0,0,0,0.05), 0 8px 10px -6px rgba(0,0,0,0.02);
            --shadow-md: 0 20px 30px -10px rgba(0,0,0,0.1);
            --radius: 24px;
            --radius-sm: 16px;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: var(--soft-bg);
            color: var(--secondary);
            line-height: 1.6;
        }
        .container {
            width: 92%;
            max-width: 1280px;
            margin: 0 auto;
        }

        /* ----- GLASS NAVIGATION ----- */
        nav {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: white;
            padding: 0.8rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            color: white;
            text-decoration: none;
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-badge {
            background: rgba(255,255,255,0.15);
            padding: 0.4rem 1rem;
            border-radius: 40px;
            font-size: 0.85rem;
            backdrop-filter: blur(4px);
            display: flex;
            gap: 0.5rem;
        }

        /* ----- SCROLLABLE TABS (MOBILE FRIENDLY) ----- */
        .tabs-wrapper {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 70px;
            z-index: 900;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .tabs-wrapper::-webkit-scrollbar { display: none; }
        .tabs {
            display: inline-flex;
            padding: 0.5rem 1rem;
            gap: 0.5rem;
        }
        .tab {
            padding: 0.7rem 1.3rem;
            border: none;
            background: transparent;
            border-radius: 40px;
            font-size: 0.95rem;
            font-weight: 500;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .tab i { font-size: 1rem; }
        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(37,99,235,0.3);
        }

        /* ----- CONTENT SECTIONS ----- */
        .tab-content {
            display: none;
            padding: 2rem 0;
        }
        .tab-content.active { display: block; }

        /* ----- MODERN CARDS (GLASSMORPHISM) ----- */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.8rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin-bottom: 1.5rem;
        }
        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
            border-color: rgba(37,99,235,0.3);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.8rem;
        }

        /* ----- BUTTONS & INPUTS ----- */
        .btn {
            background: var(--primary);
            color: white;
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 8px 16px -6px rgba(37,99,235,0.4);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn:hover {
            background: var(--primary-dark);
            transform: scale(0.98);
        }
        input, select {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid #e2e8f0;
            border-radius: 50px;
            font-size: 1rem;
            background: white;
            transition: 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
        }

        /* ----- MAP CONTAINER (Leaflet) ----- */
        #map {
            height: 380px;
            width: 100%;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            border: 2px solid white;
            box-shadow: var(--shadow-sm);
            z-index: 1;
        }

        /* ----- 3-OPTION SELECTOR (PILLS) ----- */
        .option-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin: 1rem 0 1.5rem;
        }
        .option-btn {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 0.7rem 1.5rem;
            border-radius: 40px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
        }
        .option-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .option-btn i { font-size: 1.1rem; }

        /* ----- RESULT LIST ITEMS (with directions button) ----- */
        .place-item {
            background: white;
            padding: 1.2rem 1.5rem;
            margin-bottom: 0.8rem;
            border-radius: var(--radius-sm);
            border-left: 6px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            transition: 0.2s;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .place-item:hover {
            background: #f1f5f9;
        }
        .place-info {
            flex: 1;
        }
        .place-actions {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .distance-badge {
            background: var(--accent);
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .direction-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            text-decoration: none;
        }
        .direction-btn:hover {
            background: #059669;
            transform: scale(0.98);
        }

        /* ----- EMERGENCY CARDS (click-to-call) ----- */
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1.2rem;
        }
        .emergency-card {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border-radius: 20px;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: 0.2s;
        }
        .emergency-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .emergency-number {
            font-size: 2rem;
            font-weight: 800;
            color: #dc2626;
            line-height: 1.2;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.3rem;
            padding: 0.3rem 1rem;
            border-radius: 50px;
            transition: 0.2s;
            background: #fee2e2;
        }
        .emergency-number:hover {
            background: #fecaca;
        }
        .emergency-number i {
            font-size: 1.1rem;
            color: #059669;
        }

        /* ----- BLOG GRID (20 boxes linking to blog.html) ----- */
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .blog-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-sm);
            transition: 0.2s;
            border-top: 4px solid var(--primary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: inherit;
        }
        .blog-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .blog-card h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        .blog-card p {
            color: #64748b;
            font-size: 0.9rem;
            flex: 1;
        }
        .blog-card .read-more {
            margin-top: 1rem;
            color: var(--primary);
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* ----- REMINDERS ----- */
        .reminder-item {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 40px;
            margin-bottom: 0.7rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e2e8f0;
        }

        /* ----- LOADER ----- */
        .loader {
            border: 4px solid #f1f5f9;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ----- FOOTER ----- */
        footer {
            background: var(--secondary);
            color: #cbd5e1;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
            border-radius: 40px 40px 0 0;
        }

        /* ----- RESPONSIVE ----- */
        @media (max-width: 640px) {
            .logo { font-size: 1.5rem; }
            .nav-badge { display: none; }
            .card { padding: 1.2rem; }
            .emergency-number { font-size: 1.6rem; }
            .place-item { flex-direction: column; align-items: flex-start; }
            .place-actions { margin-top: 0.8rem; width: 100%; justify-content: flex-start; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="#" class="logo">MediConnect</a>
            <div class="nav-badge">
                <i class="fas fa-map"></i> Bhubaneswar (Fallback)
                <i class="fas fa-phone-alt" style="margin-left:0.8rem;"></i> Tap to Call
                <i class="fas fa-bell" style="margin-left:0.8rem;"></i> Sound Alerts
            </div>
        </div>
    </nav>

    <!-- Tabs (scrollable) -->
    <div class="tabs-wrapper">
        <div class="container" style="padding:0;">
            <div class="tabs">
                <button class="tab active" onclick="openTab('home')"><i class="fas fa-home"></i> Home</button>
                <button class="tab" onclick="openTab('disease')"><i class="fas fa-magnifying-glass"></i> Disease</button>
                <button class="tab" onclick="openTab('medicine')"><i class="fas fa-pills"></i> Medicine</button>
                <button class="tab" onclick="openTab('nearby')"><i class="fas fa-hospital"></i> Nearby</button>
                <button class="tab" onclick="openTab('emergency')"><i class="fas fa-truck-medical"></i> Emergency</button>
               <a href="consultancy.html" class="tab" style="text-decoration: none; ...">üë®‚Äç‚öïÔ∏è Consult</a>
                <button class="tab" onclick="openTab('blogs')"><i class="fas fa-newspaper"></i> Blogs</button>
                <button class="tab" onclick="openTab('reminders')"><i class="fas fa-clock"></i> Reminders</button>
            </div>
        </div>
    </div>

    <!-- ========== HOME TAB ========= -->
    <div id="home" class="tab-content active container">
        <div class="card" style="background: linear-gradient(135deg, #2563eb, #1e40af); color: white; border: none;">
            <h1 style="font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem;">MediConnect</h1>
            <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 1.8rem;">Tap to call emergency ‚Ä¢ Sound reminders ‚Ä¢ 10km medical search ‚Ä¢ 20+ health articles</p>
            <div style="display: flex; gap: 0.6rem; max-width: 600px; flex-wrap: wrap;">
                <input type="text" id="quickSearch" placeholder="Search disease or medicine..." style="flex: 1; background: rgba(255,255,255,0.9);">
                <button class="btn" onclick="quickSearch()" style="background: white; color: #1e40af;"><i class="fas fa-search"></i> Search</button>
            </div>
        </div>
        <h2 style="font-size: 1.8rem; font-weight: 600; margin: 2rem 0 1rem;">Free services</h2>
        <div class="grid">
            <div class="card"><i class="fas fa-book-medical" style="font-size: 2.2rem; color: var(--primary);"></i><h3 style="margin: 1rem 0 0.5rem;">Disease details</h3><p style="color: #475569;">Symptoms, causes, treatment, prevention.</p></div>
            <div class="card"><i class="fas fa-pills" style="font-size: 2.2rem; color: var(--primary);"></i><h3 style="margin: 1rem 0 0.5rem;">Medicine details</h3><p style="color: #475569;">Uses, dosage, side effects, price estimate.</p></div>
            <div class="card"><i class="fas fa-map-marked-alt" style="font-size: 2.2rem; color: var(--primary);"></i><h3 style="margin: 1rem 0 0.5rem;">10km Nearby + Directions</h3><p style="color: #475569;">Hospitals, clinics, pharmacies with one‚Äëtap navigation.</p></div>
            <div class="card"><i class="fas fa-ambulance" style="font-size: 2.2rem; color: var(--primary);"></i><h3 style="margin: 1rem 0 0.5rem;">Emergency Call</h3><p style="color: #475569;">Tap numbers to call ambulance, police, fire ‚Äì India default.</p></div>
        </div>
    </div>

    <!-- ========== DISEASE TAB ========= -->
    <div id="disease" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 1rem;">üîç Disease details</h2>
        <div style="display: flex; gap: 0.6rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <input type="text" id="diseaseSearch" placeholder="e.g., Diabetes, Malaria, COVID-19" style="flex: 2;">
            <button class="btn" onclick="searchDisease()"><i class="fas fa-search"></i> Search</button>
        </div>
        <div id="diseaseResult"></div>
        <div id="diseaseLoader" class="loader" style="display:none;"></div>
    </div>

    <!-- ========== MEDICINE TAB ========= -->
    <div id="medicine" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 1rem;">üíä Medicine details</h2>
        <div style="display: flex; gap: 0.6rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <input type="text" id="medicineSearch" placeholder="e.g., Paracetamol, Metformin" style="flex: 2;">
            <button class="btn" onclick="searchMedicine()"><i class="fas fa-search"></i> Search</button>
        </div>
        <div id="medicineResult"></div>
        <div id="medicineLoader" class="loader" style="display:none;"></div>
    </div>

    <!-- ========== NEARBY TAB ‚Äì 10km, Directions, 3 Options ========= -->
    <div id="nearby" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem;">üè• 10km Medical Facilities ‚Äì with Directions</h2>
        <p style="color: #475569; margin-bottom: 1rem;"><i class="fas fa-location-dot"></i> Auto‚Äësearch when you open this tab. <strong style="background: #e6f7e6; padding: 0.2rem 0.8rem; border-radius: 20px;">‚úì 10km radius ‚Ä¢ Closest first ‚Ä¢ One‚Äëtap navigation</strong></p>
        
        <div class="option-selector">
            <div id="optHospital" class="option-btn active" onclick="setPlaceType('hospital')">
                <i class="fas fa-hospital"></i> Hospitals
            </div>
            <div id="optClinic" class="option-btn" onclick="setPlaceType('clinic')">
                <i class="fas fa-clinic-medical"></i> Clinics
            </div>
            <div id="optPharmacy" class="option-btn" onclick="setPlaceType('pharmacy')">
                <i class="fas fa-prescription-bottle"></i> Medical Stores
            </div>
        </div>

        <div id="map"></div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap;">
            <span style="background: #e2e8f0; padding: 0.3rem 1rem; border-radius: 30px;">
                <span id="placeCount">0</span> <span id="placeTypeLabel">hospitals</span> found within 10km
            </span>
            <button class="btn" onclick="searchNearby()" style="background: var(--secondary);">
                <i class="fas fa-rotate"></i> Refresh
            </button>
        </div>
        
        <ul id="placeList" style="list-style: none;"></ul>
    </div>

    <!-- ========== EMERGENCY TAB ‚Äì CLICK TO CALL ========= -->
    <div id="emergency" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem;">üöë Emergency numbers ‚Äì Tap to Call</h2>
        <label for="countrySelect" style="font-weight: 500;">Select country:</label>
        <select id="countrySelect" onchange="updateEmergencyNumbers()" style="max-width: 300px; margin-bottom: 1.5rem;"></select>
        <div class="emergency-grid">
            <div class="emergency-card">
                <h3 style="margin-bottom: 0.5rem;">üöë Ambulance</h3>
                <a id="ambulanceLink" href="tel:102" class="emergency-number">102 <i class="fas fa-phone-alt"></i></a>
            </div>
            <div class="emergency-card">
                <h3 style="margin-bottom: 0.5rem;">üëÆ Police</h3>
                <a id="policeLink" href="tel:100" class="emergency-number">100 <i class="fas fa-phone-alt"></i></a>
            </div>
            <div class="emergency-card">
                <h3 style="margin-bottom: 0.5rem;">üî• Fire</h3>
                <a id="fireLink" href="tel:101" class="emergency-number">101 <i class="fas fa-phone-alt"></i></a>
            </div>
            <div class="emergency-card">
                <h3 style="margin-bottom: 0.5rem;">‚ò£ Poison</h3>
                <a id="poisonLink" href="tel:1800116111" class="emergency-number">1800-11-6111 <i class="fas fa-phone-alt"></i></a>
            </div>
        </div>
        <p style="margin-top: 1rem; color: #475569;"><i class="fas fa-info-circle"></i> Tap number to call (mobile) ‚Äì on desktop, number is copied to clipboard.</p>
    </div>
    <!-- ========== BLOGS TAB ‚Äì 20 BOXES linking to blog.html ========= -->
    <div id="blogs" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem;">üìö Health blog ‚Äì 20 articles</h2>
        <p style="color: #475569; margin-bottom: 1.5rem;">Click any card to read the full article on our dedicated blog page.</p>
        <div class="blog-grid" id="blogGrid"></div>
    </div>

    <!-- ========== REMINDERS ‚Äì with NOTIFICATION + SOUND ========= -->
    <div id="reminders" class="tab-content container">
        <h2 style="font-size: 1.8rem; margin-bottom: 1rem;">‚è∞ Medicine reminders ‚Äì with Sound & Notification</h2>
        <div class="card" style="background: white;">
            <div style="display: flex; gap: 0.8rem; flex-wrap: wrap; align-items: flex-end;">
                <div style="flex: 2;">
                    <label style="font-size: 0.9rem; color: #475569;">Medicine name</label>
                    <input type="text" id="reminderMed" placeholder="e.g., Paracetamol">
                </div>
                <div style="flex: 1;">
                    <label style="font-size: 0.9rem; color: #475569;">Time</label>
                    <input type="time" id="reminderTime">
                </div>
                <div style="flex: 0 0 auto;">
                    <button class="btn" onclick="addReminder()" style="margin-top: 0.5rem;"><i class="fas fa-plus"></i> Set Reminder</button>
                </div>
            </div>
            <p style="margin-top: 1rem; color: #475569; font-size: 0.9rem;"><i class="fas fa-bell"></i> You'll get a notification + unique beep sound at the set time (keep page open).</p>
        </div>
        <div id="reminderList"></div>
    </div>

    <footer>
        <div class="container">
            <p style="margin-bottom: 0.5rem;">MediConnect ‚Äì Bhubaneswar fallback ‚Ä¢ Tap to call emergency ‚Ä¢ Sound reminders ‚Ä¢ 20+ full‚Äëarticle blog</p>
            <p style="font-size: 0.85rem; opacity: 0.8;">¬© 2025 ‚Ä¢ Data ¬© OpenStreetMap contributors ‚Ä¢ Wikipedia ‚Ä¢ Always consult a doctor.</p>
        </div>
    </footer>

    <script>
        // ---------- GLOBAL VARIABLES ----------
        let map;
        let userMarker;
        let userLat = null;
        let userLon = null;
        let currentPlaceType = 'hospital';
        let markersLayer;

        // ---------- STATIC DATABASES (Disease & Medicine) ----------
        const commonDiseases = [
            { name: "diabetes", displayName: "Diabetes Mellitus (Type 2)", symptoms: "Increased thirst, frequent urination, hunger, fatigue, blurred vision", causes: "Insulin resistance, genetics, obesity, sedentary lifestyle", prevention: "Healthy diet, regular exercise, weight control, avoid sugar", treatment: "Metformin, insulin therapy, lifestyle modifications, blood sugar monitoring" },
            { name: "malaria", displayName: "Malaria", symptoms: "Fever, chills, sweating, headache, nausea, muscle pain", causes: "Plasmodium parasite transmitted by Anopheles mosquito bite", prevention: "Mosquito nets, repellents, antimalarial prophylaxis", treatment: "Artemisinin-based combination therapy (ACT), chloroquine (for sensitive strains)" },
            { name: "covid-19", displayName: "COVID-19", symptoms: "Fever, cough, fatigue, loss of taste/smell, shortness of breath", causes: "SARS-CoV-2 virus", prevention: "Vaccination, masks, social distancing, hand hygiene", treatment: "Supportive care, antivirals (Paxlovid), steroids for severe cases" },
            { name: "hypertension", displayName: "Hypertension (High Blood Pressure)", symptoms: "Often asymptomatic, headache, shortness of breath, nosebleeds", causes: "High salt intake, obesity, stress, genetics, age", prevention: "Low-sodium diet, exercise, no smoking, limited alcohol", treatment: "ACE inhibitors, ARBs, diuretics, beta-blockers, lifestyle changes" },
            { name: "tuberculosis", displayName: "Tuberculosis (TB)", symptoms: "Persistent cough, weight loss, night sweats, fever, chest pain", causes: "Mycobacterium tuberculosis bacteria, airborne", prevention: "BCG vaccine, avoiding close contact, ventilation", treatment: "Isoniazid, rifampicin, ethambutol, pyrazinamide (6-9 months)" }
        ];
        const commonMedicines = [
            { name: "paracetamol", displayName: "Paracetamol (Acetaminophen)", uses: "Fever, mild to moderate pain (headache, body ache, toothache)", dosage: "500-1000 mg every 4-6 hours, max 4000 mg/day", sideEffects: "Rare; liver damage with overdose", priceRange: "‚Çπ10 - ‚Çπ30 for 10 tablets" },
            { name: "ibuprofen", displayName: "Ibuprofen", uses: "Pain, inflammation, fever, arthritis", dosage: "200-400 mg every 6-8 hours, max 1200 mg/day (OTC)", sideEffects: "Stomach upset, heartburn, bleeding risk", priceRange: "‚Çπ15 - ‚Çπ40 for 10 tablets" },
            { name: "metformin", displayName: "Metformin", uses: "Type 2 diabetes, PCOS", dosage: "500-2000 mg daily in divided doses", sideEffects: "Nausea, diarrhea, metallic taste", priceRange: "‚Çπ20 - ‚Çπ60 for 10 tablets" },
            { name: "amoxicillin", displayName: "Amoxicillin", uses: "Bacterial infections (ear, throat, UTI)", dosage: "250-500 mg three times daily (prescription)", sideEffects: "Diarrhea, rash, allergic reactions", priceRange: "‚Çπ30 - ‚Çπ80 for 10 capsules" },
            { name: "loratadine", displayName: "Loratadine", uses: "Allergy symptoms, hay fever, hives", dosage: "10 mg once daily", sideEffects: "Drowsiness (rare), dry mouth", priceRange: "‚Çπ25 - ‚Çπ50 for 10 tablets" }
        ];

        // ---------- EMERGENCY CONTACTS ----------
        const emergencyContacts = {
            india: { country: "India", ambulance: "102", police: "100", fire: "101", poison: "1800-11-6111" },
            us: { country: "USA", ambulance: "911", police: "911", fire: "911", poison: "1-800-222-1222" },
            uk: { country: "UK", ambulance: "999", police: "999", fire: "999", poison: "111" },
            canada: { country: "Canada", ambulance: "911", police: "911", fire: "911", poison: "1-844-764-7669" },
            australia: { country: "Australia", ambulance: "000", police: "000", fire: "000", poison: "13 11 26" }
        };

        // ---------- BLOG ARTICLES METADATA (for index.html ‚Äì only titles & summaries) ----------
        const blogMetadata = [
            { id: 1, title: "Research Roundup: Latest Breakthroughs in Diabetes Care", summary: "A curated summary of the newest studies on diabetes management, medications, and lifestyle interventions." },
            { id: 2, title: "Myths and Misconceptions About Vaccines", summary: "Separating fact from fiction ‚Äì we debunk common vaccine myths with science." },
            { id: 3, title: "National Health Observances: October Awareness Days", summary: "October is packed with health awareness events ‚Äì here‚Äôs how you can participate." },
            { id: 4, title: "Living with Epilepsy: A Patient's Story", summary: "Riya shares her journey from diagnosis to advocacy ‚Äì and how she found strength in community." },
            { id: 5, title: "Q&A with the American Lung Association", summary: "We sat down with Dr. Meera Sharma to discuss lung cancer screening, air quality, and advocacy." },
            { id: 6, title: "Clinical Trials: What You Need to Know", summary: "A beginner‚Äôs guide to participating in medical research ‚Äì benefits, risks, and how to find trials." },
            { id: 7, title: "Frequently Asked Questions About Cholesterol", summary: "Your top questions about LDL, HDL, triglycerides ‚Äì answered simply." },
            { id: 8, title: "Medical Jargon Explained: 10 Terms You Should Know", summary: "From 'benign' to 'idiopathic' ‚Äì a plain‚Äëlanguage guide to confusing medical words." },
            { id: 9, title: "10 Tips for Managing Migraine at Home", summary: "Lifestyle changes and remedies that can reduce the frequency and severity of migraines." },
            { id: 10, title: "Health Tech Innovators to Watch in 2025", summary: "Five companies transforming patient care through AI, wearables, and telemedicine." },
            { id: 11, title: "Recap: HIMSS 2025 Key Takeaways", summary: "Our team attended the global health conference ‚Äì here are the top trends." },
            { id: 12, title: "Support Resources for Alzheimer‚Äôs Caregivers", summary: "A curated list of organisations, hotlines, and online communities for those caring for loved ones with dementia." },
            { id: 13, title: "5 Trends Reshaping Global Health", summary: "From personalised vaccines to climate‚Äëconscious healthcare ‚Äì what you need to know." },
            { id: 14, title: "From Webinar to Blog: Repurposing Content", summary: "How we transformed a 60‚Äëminute webinar into five high‚Äëperforming blog posts ‚Äì a case study." },
            { id: 15, title: "Staying Healthy During Monsoon Season", summary: "Prevent waterborne diseases, mosquito breeding, and fungal infections with these tips." },
            { id: 16, title: "Caregiver Corner: Avoiding Burnout", summary: "Practical self‚Äëcare strategies for family caregivers ‚Äì you can‚Äôt pour from an empty cup." },
            { id: 17, title: "Press Release: MediConnect Partners with Apollo Hospitals", summary: "We‚Äôre excited to announce a collaboration to integrate emergency services and hospital locator data." },
            { id: 18, title: "Deep Dive: How GLP‚Äë1 Agonists Work for Weight Loss", summary: "Beyond diabetes ‚Äì the science behind semaglutide, liraglutide, and the new generation of anti‚Äëobesity drugs." },
            { id: 19, title: "Small Cell vs Non‚ÄëSmall Cell Lung Cancer", summary: "What‚Äôs the difference? Prognosis, treatment approaches, and key biomarkers explained." },
            { id: 20, title: "Guest Post: Nutrition Tips for Cancer Survivors", summary: "Registered dietitian Laura M. shares evidence‚Äëbased advice on eating well during and after treatment." }
        ];

        // ---------- REMINDER SYSTEM ----------
        let reminders = JSON.parse(localStorage.getItem('medReminders')) || [];
        let audioContext = null;
        let reminderInterval = null;

        if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
            Notification.requestPermission();
        }

        function initAudio() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playAlertSound() {
            initAudio();
            if (audioContext.state === 'suspended') audioContext.resume();
            const now = audioContext.currentTime;
            for (let i = 0; i < 3; i++) {
                const osc = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                osc.type = 'sine';
                osc.frequency.value = 880;
                gainNode.gain.setValueAtTime(0.3, now + i * 0.15);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + i * 0.15 + 0.1);
                osc.connect(gainNode);
                gainNode.connect(audioContext.destination);
                osc.start(now + i * 0.15);
                osc.stop(now + i * 0.15 + 0.2);
            }
        }

        function startReminderChecker() {
            if (reminderInterval) clearInterval(reminderInterval);
            reminderInterval = setInterval(() => {
                const now = new Date();
                const currentTime = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
                reminders.forEach(r => {
                    if (!r.taken && r.time === currentTime) {
                        if (Notification.permission === 'granted') {
                            new Notification('MediConnect Reminder', {
                                body: `Time to take ${r.medicine}`,
                                icon: 'https://cdn-icons-png.flaticon.com/512/2966/2966327.png',
                                silent: false
                            });
                        }
                        playAlertSound();
                        r.taken = true;
                        saveReminders();
                        alert(`‚è∞ Medicine Reminder: ${r.medicine} at ${r.time}`);
                    }
                });
            }, 60000);
        }

        window.addEventListener('beforeunload', () => {
            if (reminderInterval) clearInterval(reminderInterval);
        });

        function saveReminders() { 
            localStorage.setItem('medReminders', JSON.stringify(reminders)); 
            displayReminders(); 
        }
        
        window.addReminder = function() {
            const med = document.getElementById('reminderMed').value.trim();
            const time = document.getElementById('reminderTime').value;
            if (!med || !time) return alert('Enter medicine and time');
            if (Notification.permission !== 'granted') Notification.requestPermission();
            reminders.push({ id: Date.now(), medicine: med, time, taken: false });
            saveReminders();
            document.getElementById('reminderMed').value = '';
            document.getElementById('reminderTime').value = '';
            alert(`‚è∞ Reminder set for ${med} at ${time}. You'll hear a beep and get a notification.`);
            initAudio();
        };
        
        window.markTaken = function(id) { 
            let r = reminders.find(r => r.id === id); 
            if(r) r.taken = true; 
            saveReminders(); 
        };
        
        window.deleteReminder = function(id) { 
            reminders = reminders.filter(r => r.id !== id); 
            saveReminders(); 
        };
        
        function displayReminders() {
            const list = document.getElementById('reminderList');
            if (!reminders.length) list.innerHTML = '<p style="color:#64748b; text-align:center;">No reminders yet.</p>';
            else list.innerHTML = reminders.map(r => `
                <div class="reminder-item">
                    <div><strong>${r.medicine}</strong> at ${r.time} ${r.taken ? '‚úÖ' : '‚è≥'}</div>
                    <div>
                        <button onclick="markTaken(${r.id})" style="background:#10b981; color:white; border:none; padding:0.4rem 0.9rem; border-radius:30px;"><i class="fas fa-check"></i></button>
                        <button onclick="deleteReminder(${r.id})" style="background:#ef4444; color:white; border:none; padding:0.4rem 0.9rem; border-radius:30px; margin-left:0.5rem;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        // ---------- TAB SWITCHING ----------
        window.openTab = function(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            if (tabId === 'nearby') setTimeout(() => initMap(), 100);
            if (tabId === 'blogs') populateBlogGrid(); // Populate blogs when tab opens
        };

        // ---------- MAP FUNCTIONS (Bhubaneswar fallback) ----------
        window.initMap = function() {
            if (map) {
                if (userLat && userLon) { map.setView([userLat, userLon], 14); searchNearby(); } 
                else getUserLocation();
                return;
            }
            map = L.map('map').setView([20.2961, 85.8245], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap', maxZoom: 19 }).addTo(map);
            markersLayer = L.layerGroup().addTo(map);
            getUserLocation();
        };

        window.getUserLocation = function() {
            document.getElementById('placeList').innerHTML = '<div class="loader" style="margin:2rem auto;"></div>';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude; userLon = position.coords.longitude;
                        map.setView([userLat, userLon], 14);
                        if (userMarker) map.removeLayer(userMarker);
                        userMarker = L.marker([userLat, userLon], {
                            icon: L.divIcon({ className: 'user-marker', html: '<i class="fas fa-circle-user" style="font-size: 2rem; color: #2563eb; text-shadow: 0 0 10px white;"></i>', iconSize: [32,32], iconAnchor: [16,16] })
                        }).addTo(map).bindPopup('You are here');
                        searchNearby();
                    },
                    error => {
                        userLat = 20.2961; userLon = 85.8245;
                        map.setView([userLat, userLon], 12);
                        userMarker = L.marker([userLat, userLon], {
                            icon: L.divIcon({ html: '<i class="fas fa-circle-user" style="font-size: 2rem; color: #2563eb;"></i>', iconSize: [32,32], iconAnchor: [16,16] })
                        }).addTo(map).bindPopup('Fallback: Bhubaneswar');
                        document.getElementById('placeList').innerHTML = '<li class="card" style="color:#b91c1c;">‚ùå Location access denied. Showing results for Bhubaneswar as fallback.</li>';
                        searchNearby();
                    }
                );
            } else {
                userLat = 20.2961; userLon = 85.8245;
                map.setView([userLat, userLon], 12);
                userMarker = L.marker([userLat, userLon]).addTo(map).bindPopup('Fallback: Bhubaneswar');
                document.getElementById('placeList').innerHTML = '<li class="card" style="color:#b91c1c;">‚ùå Geolocation not supported. Showing results for Bhubaneswar.</li>';
                searchNearby();
            }
        };

        window.setPlaceType = function(type) {
            currentPlaceType = type;
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('active'));
            if (type === 'hospital') document.getElementById('optHospital').classList.add('active');
            if (type === 'clinic') document.getElementById('optClinic').classList.add('active');
            if (type === 'pharmacy') document.getElementById('optPharmacy').classList.add('active');
            document.getElementById('placeTypeLabel').innerText = type === 'hospital' ? 'hospitals' : (type === 'clinic' ? 'clinics' : 'medical stores');
            searchNearby();
        };

        function getDirectionsUrl(destLat, destLon) {
            return `https://www.google.com/maps/dir/?api=1&origin=${userLat},${userLon}&destination=${destLat},${destLon}&travelmode=driving`;
        }

        window.searchNearby = function() {
            if (!map || !userLat || !userLon) return;
            document.getElementById('placeList').innerHTML = '<div class="loader" style="margin:2rem auto;"></div>';
            document.getElementById('placeCount').innerText = '0';
            if (markersLayer) markersLayer.clearLayers();
            else markersLayer = L.layerGroup().addTo(map);
            let osmTag = currentPlaceType === 'hospital' ? 'amenity=hospital' : (currentPlaceType === 'clinic' ? 'amenity=clinic' : 'amenity=pharmacy');
            const radius = 10000;
            const query = `[out:json];(node[${osmTag}](around:${radius},${userLat},${userLon});way[${osmTag}](around:${radius},${userLat},${userLon});relation[${osmTag}](around:${radius},${userLat},${userLon}););out center tags;`;
            fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`)
                .then(r => r.json())
                .then(data => {
                    let elements = data.elements;
                    if (!elements.length) {
                        document.getElementById('placeList').innerHTML = `<li class="card" style="text-align:center;">No ${currentPlaceType}s found within 10km.</li>`;
                        document.getElementById('placeCount').innerText = '0'; return;
                    }
                    let places = [];
                    elements.forEach(el => {
                        let lat, lon;
                        if (el.type === 'node') { lat = el.lat; lon = el.lon; } 
                        else if (el.center) { lat = el.center.lat; lon = el.center.lon; } else return;
                        const dist = getDistance(userLat, userLon, lat, lon);
                        places.push({
                            name: el.tags?.name || `Unnamed ${currentPlaceType}`,
                            lat, lon, distance: dist,
                            phone: el.tags?.phone || el.tags?.['contact:phone'] || 'Not listed',
                            address: el.tags?.['addr:full'] || [el.tags?.['addr:street'], el.tags?.['addr:housenumber']].filter(Boolean).join(' ') || 'Address not available'
                        });
                    });
                    places.sort((a,b) => a.distance - b.distance);
                    document.getElementById('placeCount').innerText = places.length;
                    let html = '';
                    places.forEach((p,i) => {
                        L.marker([p.lat, p.lon]).addTo(markersLayer).bindPopup(`<strong>${p.name}</strong><br>${p.address}<br>üìû ${p.phone}<br>${p.distance.toFixed(1)} km away<br><a href="${getDirectionsUrl(p.lat, p.lon)}" target="_blank" style="display:inline-block; margin-top:8px; background:#10b981; color:white; padding:6px 12px; border-radius:30px; text-decoration:none;"><i class="fas fa-location-arrow"></i> Directions</a>`);
                        html += `<li class="place-item"><div class="place-info"><strong style="font-size:1.1rem;">${i+1}. ${p.name}</strong><br><span style="color:#475569;">${p.address}</span><br>üìû ${p.phone}</div><div class="place-actions"><span class="distance-badge">${p.distance.toFixed(1)} km</span><a href="${getDirectionsUrl(p.lat, p.lon)}" target="_blank" class="direction-btn"><i class="fas fa-location-arrow"></i> Directions</a></div></li>`;
                    });
                    document.getElementById('placeList').innerHTML = html;
                })
                .catch(() => {
                    document.getElementById('placeList').innerHTML = '<li class="card" style="color:#b91c1c;">‚ö†Ô∏è Error loading facilities. Try again.</li>';
                    document.getElementById('placeCount').innerText = '0';
                });
        };

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2-lat1)*Math.PI/180, dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        // ---------- QUICK SEARCH ----------
        window.quickSearch = function() {
            let q = document.getElementById('quickSearch').value.trim();
            if (!q) return;
            openTab('disease');
            document.getElementById('diseaseSearch').value = q;
            searchDisease();
        };

        // ---------- DISEASE SEARCH ----------
        window.searchDisease = function() {
            let q = document.getElementById('diseaseSearch').value.trim().toLowerCase();
            if (!q) return;
            let res = document.getElementById('diseaseResult'), loader = document.getElementById('diseaseLoader');
            res.innerHTML = ''; loader.style.display = 'block';
            let match = commonDiseases.find(d => d.name.includes(q) || q.includes(d.name) || d.displayName.toLowerCase().includes(q));
            if (match) {
                loader.style.display = 'none';
                res.innerHTML = `<div class="card"><h2 style="color:var(--primary);">${match.displayName}</h2><div><span class="detail-label">ü©∫ Symptoms</span><p>${match.symptoms}</p></div><div><span class="detail-label">üî¨ Causes</span><p>${match.causes}</p></div><div><span class="detail-label">üõ°Ô∏è Prevention</span><p>${match.prevention}</p></div><div><span class="detail-label">üíä Treatment</span><p>${match.treatment}</p></div><p style="margin-top:1.5rem; font-style:italic; color:#64748b;">Source: MediConnect Medical Database</p></div>`;
            } else {
                fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`)
                    .then(r => r.ok ? r.json() : Promise.reject())
                    .then(d => {
                        loader.style.display = 'none';
                        res.innerHTML = `<div class="card"><h2>${d.title}</h2><p>${d.extract || 'No description.'}</p>${d.thumbnail ? `<img src="${d.thumbnail.source}" style="max-width:100%; margin-top:1rem; border-radius:12px;">` : ''}<p style="margin-top:1rem;"><a href="${d.content_urls?.desktop?.page}" target="_blank">üîó Read full article</a></p><p style="color:#64748b; margin-top:1rem;"><i class="fas fa-info-circle"></i> Wikipedia summary</p></div>`;
                    })
                    .catch(() => {
                        loader.style.display = 'none';
                        res.innerHTML = `<div class="card" style="color:#b91c1c;"><i class="fas fa-exclamation-triangle"></i> Disease not found.</div>`;
                    });
            }
        };

        // ---------- MEDICINE SEARCH ----------
        window.searchMedicine = function() {
            let q = document.getElementById('medicineSearch').value.trim().toLowerCase();
            if (!q) return;
            let res = document.getElementById('medicineResult'), loader = document.getElementById('medicineLoader');
            res.innerHTML = ''; loader.style.display = 'block';
            let match = commonMedicines.find(m => m.name.includes(q) || q.includes(m.name) || m.displayName.toLowerCase().includes(q));
            if (match) {
                loader.style.display = 'none';
                res.innerHTML = `<div class="card"><h2 style="color:var(--primary);">${match.displayName}</h2><span style="background:#27ae60; color:white; padding:0.3rem 1rem; border-radius:30px; display:inline-block; margin:0.8rem 0;"><i class="fas fa-rupee-sign"></i> ${match.priceRange}</span><div><span class="detail-label">üí° Uses</span><p>${match.uses}</p></div><div><span class="detail-label">‚è∞ Dosage</span><p>${match.dosage}</p></div><div><span class="detail-label">‚ö†Ô∏è Side effects</span><p>${match.sideEffects}</p></div><p style="margin-top:1.5rem; font-style:italic; color:#64748b;">Source: MediConnect Medicine Database ‚Ä¢ Prices are estimates</p></div>`;
            } else {
                fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`)
                    .then(r => r.ok ? r.json() : Promise.reject())
                    .then(d => {
                        loader.style.display = 'none';
                        res.innerHTML = `<div class="card"><h2>${d.title}</h2><p>${d.extract || 'No description.'}</p>${d.thumbnail ? `<img src="${d.thumbnail.source}" style="max-width:100%; margin-top:1rem; border-radius:12px;">` : ''}<p style="margin-top:1rem;"><a href="${d.content_urls?.desktop?.page}" target="_blank">üîó Read full article</a></p><p style="color:#64748b; margin-top:1rem;"><i class="fas fa-info-circle"></i> Wikipedia summary</p></div>`;
                    })
                    .catch(() => {
                        loader.style.display = 'none';
                        res.innerHTML = `<div class="card" style="color:#b91c1c;"><i class="fas fa-exclamation-triangle"></i> Medicine not found.</div>`;
                    });
            }
        };

        // ---------- EMERGENCY NUMBERS ----------
        window.updateEmergencyNumbers = function() {
            const code = document.getElementById('countrySelect').value;
            const c = emergencyContacts[code];
            document.getElementById('ambulanceLink').href = `tel:${c.ambulance.replace(/\D/g,'')}`;
            document.getElementById('ambulanceLink').innerHTML = `${c.ambulance} <i class="fas fa-phone-alt"></i>`;
            document.getElementById('policeLink').href = `tel:${c.police.replace(/\D/g,'')}`;
            document.getElementById('policeLink').innerHTML = `${c.police} <i class="fas fa-phone-alt"></i>`;
            document.getElementById('fireLink').href = `tel:${c.fire.replace(/\D/g,'')}`;
            document.getElementById('fireLink').innerHTML = `${c.fire} <i class="fas fa-phone-alt"></i>`;
            document.getElementById('poisonLink').href = `tel:${c.poison.replace(/\D/g,'')}`;
            document.getElementById('poisonLink').innerHTML = `${c.poison} <i class="fas fa-phone-alt"></i>`;
        };

        function populateCountries() {
            const sel = document.getElementById('countrySelect');
            sel.innerHTML = Object.keys(emergencyContacts).map(code => `<option value="${code}" ${code==='india'?'selected':''}>${emergencyContacts[code].country}</option>`).join('');
            updateEmergencyNumbers();
        }

        // ---------- BLOG GRID POPULATION (links to blog.html?id=X) ----------
        function populateBlogGrid() {
            const grid = document.getElementById('blogGrid');
            if (!grid) return;
            let html = '';
            blogMetadata.forEach(article => {
                html += `<a href="blog.html?id=${article.id}" class="blog-card">
                    <h3>${article.title}</h3>
                    <p>${article.summary}</p>
                    <div class="read-more">
                        <i class="fas fa-book-open"></i> Read full article
                    </div>
                </a>`;
            });
            grid.innerHTML = html;
        }

        // ---------- ON PAGE LOAD ----------
        window.onload = function() {
            openTab('home');
            populateCountries();
            displayReminders();
            startReminderChecker();
            initAudio();
            // Pre-populate blog grid in case Blogs tab is active on load (not likely)
            if (document.getElementById('blogs').classList.contains('active')) populateBlogGrid();
        };
    </script>
</body>
</html>
